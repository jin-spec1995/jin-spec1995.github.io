<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>JSB Banana Path Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            touch-action: manipulation;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 8px;
            background-color: #6a994e;
            border-radius: 12px;
            border: 4px solid #4a7c36;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .grid-cell {
            position: relative;
            aspect-ratio: 1 / 1;
            background-color: #a7c957;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1.25rem, 5vw, 2rem);
            font-weight: 700;
            color: #f2e8cf;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.2s;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2397b947' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3Csvg%3E");
        }
        .grid-cell.unvisited:hover {
            transform: scale(1.05);
            background-color: #b7d468;
        }
        .grid-cell.special-unvisited {
            background-color: #588157;
            border: 2px dashed #f2e8cf;
        }
         .grid-cell.special-unvisited:hover {
            background-color: #4a7c36;
        }
        .grid-cell.special-visited {
             background-color: #386641;
             border: 2px solid #f2e8cf;
        }
        .player {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1.5rem, 6vw, 2.5rem);
            transition: all 0.3s ease-in-out;
            pointer-events: none;
        }
        .grid-cell.visited {
            background-color: #6a994e;
            color: #a7c957;
            cursor: pointer;
        }
         .grid-cell.visited:hover {
            background-color: #8ab15a;
        }
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 24px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #dc2626;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            pointer-events: none;
            z-index: 101;
        }
        .message-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }
    </style>
</head>
<body class="bg-[#bcde9a] min-h-screen flex flex-col p-4 text-[#386641]">

    <header class="w-full max-w-6xl mx-auto px-4 py-2">
        <img src="./jsb_logo.svg" alt="Just Smart Business Logo" class="h-14" onerror="this.onerror=null;this.src='https://placehold.co/200x50/386641/f2e8cf?text=JSB+Logo';">
    </header>

    <main class="w-full max-w-6xl mx-auto flex-grow flex flex-col md:flex-row items-center justify-center gap-8 md:gap-12 mt-4">
        <!-- How to Play Section -->
        <div class="w-full md:w-1/3 p-6  rounded-lg shadow-lg border-2 border-[#6a994e]">
            <h2 class="text-3xl font-bold mb-4 text-center">How to Play üß†</h2>
            <ul class="space-y-3 text-lg">
                <li class="flex items-start">
                    <span class="mr-2">üçå</span>
                    <div>Guide the banana to cover <strong class="font-semibold">every single square</strong> on the board.</div>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚úÖ</span>
                    <div>You must land on special squares (like <span class="font-bold bg-[#588157] text-white px-1 rounded">11</span>) at the <strong class="font-semibold">exact step number</strong>.</div>
                </li>
                 <li class="flex items-start">
                    <span class="mr-2">‚û°Ô∏è</span>
                    <div>Use <strong class="font-semibold">arrow keys</strong> or <strong class="font-semibold">click</strong> an adjacent square to move.</div>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚è™</span>
                    <div>Made a mistake? Just click any <strong class="font-semibold">previous number</strong> to go back to that step!</div>
                </li>
            </ul>
        </div>

        <!-- Game Section -->
        <div class="w-full max-w-sm mx-auto">
            <div class="text-center mb-4">
                <h1 class="text-4xl font-bold text-[#386641]">JSB Banana Path</h1>
                <p class="text-lg text-[#4a7c36]">Level: <span id="level-display">1</span></p>
            </div>

            <div id="game-board" class="grid-container"></div>
            
            <div class="mt-4 text-center">
                <p class="text-xl text-[#386641]">Squares Visited: <span id="steps-taken" class="font-bold text-3xl">0</span></p>
            </div>

            <div class="mt-6 flex justify-center">
                 <button id="reset-button" class="bg-[#f2e8cf] text-[#386641] font-bold py-2 px-6 rounded-full shadow-lg hover:bg-[#e8dcb5] transition-transform transform hover:scale-105">Reset Level</button>
            </div>
        </div>
    </main>

    <footer class="w-full max-w-6xl mx-auto text-center py-4 mt-8 text-sm text-[#4a7c36]">
        <p>&copy; <span id="current-year"></span> Just Smart Business.</p>
    </footer>

    <div id="message-box" class="message-box"></div>

    <!-- Win Modal -->
    <div id="win-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-3xl font-bold text-green-600 mb-4">You did it!</h2>
            <p class="text-gray-700 mb-6">You visited all the squares!</p>
            <div id="modal-buttons" class="flex justify-center gap-4">
                 <button id="next-level-button" class="bg-green-500 text-white font-bold py-2 px-6 rounded-full hover:bg-green-600 transition-transform transform hover:scale-105">Next Level</button>
                 <button id="restart-game-button" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600 transition-transform transform hover:scale-105">Restart Game</button>
            </div>
        </div>
    </div>

    <script>
        // Set current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        const gameBoard = document.getElementById('game-board');
        const levelDisplay = document.getElementById('level-display');
        const stepsTakenDisplay = document.getElementById('steps-taken');
        const resetButton = document.getElementById('reset-button');
        const winModal = document.getElementById('win-modal');
        const nextLevelButton = document.getElementById('next-level-button');
        const restartGameButton = document.getElementById('restart-game-button');
        const messageBox = document.getElementById('message-box');

        const ROWS = 5;
        const COLS = 4;

       const levels = [
    // EASY LEVELS (1-2 specials, more forgiving paths)
    
    // Level 1: Simple introduction - just one special constraint
      { start: { r: 2, c: 2 }, specials: [
    { r: 0, c: 0, val: 5 }, { r: 3, c: 3, val: 17 }
  ]},

  // L12
  { start: { r: 3, c: 3 }, specials: [
    { r: 1, c: 3, val: 13 }, { r: 3, c: 2, val: 18 }
  ]},

  // L13
  { start: { r: 1, c: 1 }, specials: [
    { r: 0, c: 2, val: 15 }, { r: 1, c: 3, val: 19 }
  ]},

  // L14
  { start: { r: 4, c: 3 }, specials: [
    { r: 4, c: 0, val: 6 }, { r: 0, c: 0, val: 14 }
  ]},

  // L15
  { start: { r: 0, c: 0 }, specials: [
    { r: 2, c: 1, val: 10 }, { r: 1, c: 2, val: 18 }
  ]},

  // L16
  { start: { r: 1, c: 2 }, specials: [
    { r: 1, c: 1, val: 6 }, { r: 3, c: 1, val: 8 }
  ]},

  // L17
  { start: { r: 3, c: 2 }, specials: [
    { r: 0, c: 1, val: 13 }, { r: 0, c: 2, val: 16 }
  ]},

  // L18
  { start: { r: 4, c: 1 }, specials: [
    { r: 2, c: 1, val: 5 }, { r: 1, c: 1, val: 14 }
  ]},

  // L19
  { start: { r: 0, c: 3 }, specials: [
    { r: 1, c: 1, val: 14 }, { r: 2, c: 2, val: 16 }
  ]},

  // L20
  { start: { r: 1, c: 2 }, specials: [
    { r: 0, c: 2, val: 2 }, { r: 0, c: 1, val: 11 }
  ]},

  // L21 (3 specials)
  { start: { r: 3, c: 2 }, specials: [
    { r: 3, c: 3, val: 4 }, { r: 1, c: 1, val: 12 }, { r: 0, c: 1, val: 17 }
  ]},

  // L22
  { start: { r: 0, c: 2 }, specials: [
    { r: 0, c: 1, val: 10 }, { r: 3, c: 3, val: 19 }
  ]}
];

        let currentLevelIndex = 0;
        let playerPos = { r: 0, c: 0 };
        let history = [];
        let boardData = [];

        function showMessage(text, duration = 2000) {
            messageBox.textContent = text;
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, duration);
        }

        function initLevel(levelIndex) {
            const level = levels[levelIndex];
            if (!level) return;

            history = [];
            boardData = Array(ROWS).fill(null).map(() => Array(COLS).fill(null).map(() => ({
                visited: false,
                specialNumber: null,
                revealedNumber: 0
            })));

            level.specials.forEach(s => {
                boardData[s.r][s.c].specialNumber = s.val;
            });

            playerPos = { ...level.start };
            history.push(playerPos);
            boardData[playerPos.r][playerPos.c].visited = true;
            boardData[playerPos.r][playerPos.c].revealedNumber = 1;


            levelDisplay.textContent = levelIndex + 1;
            stepsTakenDisplay.textContent = `${history.length} / ${ROWS * COLS}`;
            renderBoard();
        }

        function renderBoard() {
            gameBoard.innerHTML = '';
            stepsTakenDisplay.textContent = `${history.length} / ${ROWS * COLS}`;

            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    
                    const cellData = boardData[r][c];

                    if (cellData.visited) {
                        cell.classList.add('visited');
                        cell.textContent = cellData.revealedNumber;
                        if (cellData.specialNumber) {
                           cell.classList.add('special-visited');
                        }
                    } else {
                        cell.classList.add('unvisited');
                        if (cellData.specialNumber) {
                            cell.classList.add('special-unvisited');
                            cell.textContent = cellData.specialNumber;
                        }
                    }
                    
                    if (playerPos.r === r && playerPos.c === c) {
                        const player = document.createElement('div');
                        player.classList.add('player');
                        player.textContent = 'üçå';
                        cell.appendChild(player);
                    }
                    
                    gameBoard.appendChild(cell);
                }
            }
        }

        function handleMove(dr, dc) {
            const newR = playerPos.r + dr;
            const newC = playerPos.c + dc;

            if (newR < 0 || newR >= ROWS || newC < 0 || newC >= COLS) return;

            const targetCellData = boardData[newR][newC];
            const nextStep = history.length + 1;

            if (targetCellData.visited) {
                const targetStep = targetCellData.revealedNumber;
                if (targetStep < history.length) {
                    handleBacktrackToStep(targetStep);
                }
                return;
            }

            if (targetCellData.specialNumber && targetCellData.specialNumber !== nextStep) {
                showMessage(`You must land here on step ${targetCellData.specialNumber}!`);
                gameBoard.classList.add('shake');
                setTimeout(() => gameBoard.classList.remove('shake'), 500);
                return;
            }

            playerPos = { r: newR, c: newC };
            history.push(playerPos);
            
            targetCellData.visited = true;
            targetCellData.revealedNumber = nextStep;
            
            renderBoard();

            if (history.length === ROWS * COLS) {
                setTimeout(() => showWinModal(), 500);
            }
        }

        function handleBacktrackToStep(targetStep) {
            if (targetStep >= history.length || targetStep < 1) return;
            const positionsToReset = history.slice(targetStep);
            positionsToReset.forEach(pos => {
                boardData[pos.r][pos.c].visited = false;
                boardData[pos.r][pos.c].revealedNumber = 0;
            });
            history = history.slice(0, targetStep);
            if (history.length > 0) {
                 playerPos = { ...history[history.length - 1] };
            }
            renderBoard();
        }
        
        function showWinModal() {
            winModal.style.display = 'flex';
            if (currentLevelIndex >= levels.length - 1) {
                nextLevelButton.style.display = 'none';
                restartGameButton.textContent = "Play Again?";
            } else {
                nextLevelButton.style.display = 'inline-block';
                restartGameButton.textContent = "Restart Game";
            }
        }
        
        // --- Event Listeners ---
        
        window.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp': handleMove(-1, 0); break;
                case 'ArrowDown': handleMove(1, 0); break;
                case 'ArrowLeft': handleMove(0, -1); break;
                case 'ArrowRight': handleMove(0, 1); break;
                case 'Backspace': 
                    if (history.length > 1) {
                        handleBacktrackToStep(history.length - 1);
                    }
                    break;
            }
        });
        
        gameBoard.addEventListener('click', (e) => {
            const cell = e.target.closest('.grid-cell');
            if (!cell) return;
            
            const r = parseInt(cell.dataset.r);
            const c = parseInt(cell.dataset.c);
            const cellData = boardData[r][c];

            if (cellData.visited) {
                const targetStep = cellData.revealedNumber;
                if (targetStep < history.length) {
                    handleBacktrackToStep(targetStep);
                }
                return;
            }

            const dr = r - playerPos.r;
            const dc = c - playerPos.c;
            
            if(Math.abs(dr) + Math.abs(dc) === 1) {
                handleMove(dr, dc);
            }
        });

        resetButton.addEventListener('click', () => {
            initLevel(currentLevelIndex);
        });
        
        nextLevelButton.addEventListener('click', () => {
            currentLevelIndex++;
            if (currentLevelIndex < levels.length) {
                initLevel(currentLevelIndex);
                winModal.style.display = 'none';
            }
        });

        restartGameButton.addEventListener('click', () => {
            currentLevelIndex = 0;
            initLevel(currentLevelIndex);
            winModal.style.display = 'none';
        });

        // Initial game load
        initLevel(currentLevelIndex);
    </script>

</body>
</html>

