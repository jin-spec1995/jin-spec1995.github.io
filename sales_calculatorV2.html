<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JSB Sales Calculator — Exact Sheet Logic</title>
  <style>
    :root{
      --brand-dark:#0d3b2e; --brand-mid:#0e6f57; --brand-light:#22c28a;
      --ink:#0b0b0b; --paper:#ffffff; --muted:#5e6b74; --line:#e6eaee; --chip:#f5f8f7; --warn:#b54708;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
         color:var(--ink); background:var(--paper); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
    .wrap{max-width:1180px; margin:32px 0 32px 20px; padding:0 20px 48px;} /* left for SuiteDash sidebar */
    header.brand{display:flex; align-items:flex-end; justify-content:space-between; gap:16px; margin-bottom:18px;}
    .brand-title{font-weight:800; letter-spacing:.2px; color:var(--brand-mid); font-size:22px;}
    .subtle{color:var(--muted); font-size:14px}

    .tabs{display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap}
    .tab{appearance:none; border:1px solid var(--line); background:#fff; color:#2b3a33; padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer;}
    .tab.active{border-color:#10a772; background:#f3fff9; box-shadow:0 0 0 3px rgba(16,167,114,.15); color:#0c5e49}

    .grid{display:grid; gap:16px}
    @media (min-width:980px){ .grid.cols{grid-template-columns:1.1fr 1.9fr} }
    .card{background:#fff; border:1px solid var(--line); border-radius:16px; padding:18px; box-shadow:0 1px 0 #f4f6f8;}
    .card-title{display:flex; align-items:center; gap:10px; font-weight:700; margin:2px 0 14px;}
    .section-tag{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; background:var(--chip); border-radius:24px; font-size:12px; color:var(--brand-mid); border:1px solid #eaf4f0;}
    .divider{height:1px; background:var(--line); margin:14px 0}
    .mono{font-variant-numeric:tabular-nums; font-feature-settings:"tnum" 1}

    .inputs{display:grid; grid-template-columns:1.5fr 1fr; gap:12px 12px; align-items:center;}
    label{font-size:14px; color:var(--muted)}
    input[type=number]{
      width:100%; padding:10px 14px; border-radius:12px; border:1px solid var(--line); outline:none; background:#fff;
      transition:border-color .15s, box-shadow .15s; font-size:16px; line-height:22px; height:44px;
    }
    input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
    input[type=number]{ -moz-appearance:textfield; }
    input[type=number]:focus{border-color:#10a772; box-shadow:0 0 0 3px rgba(16,167,114,.18);}
    .hint{font-size:12px; color:var(--muted); margin-top:8px}

    .actions{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}
    .btn{appearance:none; border:0; border-radius:12px; padding:11px 16px; font-weight:700; cursor:pointer; display:inline-flex; align-items:center; gap:10px; letter-spacing:.2px;}
    .btn-primary{background:linear-gradient(180deg,var(--brand-light),#10a772); color:#083524; border:1px solid #10a772}
    .btn-ghost{background:#fff; color:var(--brand-mid); border:1px solid var(--line)}
    .btn.warn{background:#fff7ed; color:#7c3b06; border:1px solid #fed7aa}

    .kpis{display:grid; gap:12px; margin-top:4px}
    @media (min-width:720px){ .kpis{grid-template-columns:repeat(4,1fr)} }
    .kpi{border:1px solid var(--line); border-radius:14px; padding:14px; background:#fff;}
    .kpi .label{font-size:12px; color:var(--muted)}
    .kpi .value{font-weight:800; font-size:20px; color:var(--ink)}
    .kpi.primary{border-color:#cef3e3; background:linear-gradient(180deg,#f7fffb,#ffffff)}
    .kpi.primary .value{color:#0e6f57}

    table{width:100%; border-collapse:separate; border-spacing:0; font-size:14px; border:1px solid var(--line); border-radius:14px; overflow:hidden}
    th,td{padding:10px 12px; border-bottom:1px solid var(--line)}
    thead th{background:#f7fbf9; text-align:left; color:#426159; font-weight:700}
    tbody tr:last-child td{border-bottom:0}
    td.right{text-align:right}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="brand">
      <div>
        <div class="brand-title">Just Smart Business</div>
        <div class="subtle">Sales Calculator — Exact workbook logic with What‑Ifs</div>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab active" data-tab="inputsTab">1) Inputs</button>
      <button class="tab" data-tab="resultsTab">2) Results</button>
      <button class="tab" data-tab="whatifTab">3) What‑Ifs</button>
    </nav>

    <!-- INPUTS -->
    <section class="card" id="inputsTab">
      <div class="card-title">
        <span class="section-tag">Data Input</span>
        <span class="subtle">Match the sheet values and units (decimals for %)</span>
      </div>
      <div class="grid cols">
        <div>
          <div class="inputs">
            <label for="G5">Average Sale Value (ex GST)</label>
            <input id="G5" type="number" step="0.01" min="0" value="550">

            <label for="G6">Average Cost of Sale (ex GST)</label>
            <input id="G6" type="number" step="0.01" min="0" value="150">

            <label for="G10">Monthly Expenses (ex GST)</label>
            <input id="G10" type="number" step="0.01" min="0" value="8211">

            <label for="G11">Number of Weeks per Year</label>
            <input id="G11" type="number" step="1" min="1" value="48">

            <label for="G12">Number of Days per Week</label>
            <input id="G12" type="number" step="1" min="1" value="5">

            <label for="G13">How much do you want to make (Desired Net Profit)</label>
            <input id="G13" type="number" step="0.01" min="0" value="100000">

            <label for="G15">Number of Existing Clients</label>
            <input id="G15" type="number" step="1" min="0" value="36">

            <label for="G16">How many times do they buy per year</label>
            <input id="G16" type="number" step="1" min="1" value="3">
          </div>

          <div class="divider"></div>

          <div class="card-title">
            <span class="section-tag">Sales Conversions</span>
            <span class="subtle">Use decimals: 0.15 = 15%</span>
          </div>
          <div class="inputs">
            <label for="G40">Clicks/Walk‑ins → Leads (decimal)</label>
            <input id="G40" type="number" step="0.0001" min="0" max="1" value="0.15">

            <label for="G41">Leads → Prospects (decimal)</label>
            <input id="G41" type="number" step="0.0001" min="0" max="1" value="0.15">

            <label for="G42">Prospects → Proposals (decimal)</label>
            <input id="G42" type="number" step="0.0001" min="0" max="1" value="0.15">

            <label for="G43">Proposals → Sales (decimal)</label>
            <input id="G43" type="number" step="0.0001" min="0" max="1" value="0.7">
          </div>

          <div class="actions">
            <button class="btn btn-primary" id="calcBtn">Calculate</button>
            <button class="btn btn-ghost" id="resetBtn" type="button">Reset</button>
          </div>
          <p class="hint">We prevent negatives and clamp conversions to 0–1 to mirror the workbook.</p>
        </div>

        <div>
          <div class="card" style="padding:12px">
            <div class="subtle">Guide</div>
            <ul style="margin:6px 0 0 16px; padding:0; line-height:1.5">
              <li><strong>Average Sale</strong> and <strong>Cost of Sale</strong> are ex‑GST.</li>
              <li><strong>Expenses</strong> are monthly; we annualise to calculate targets.</li>
              <li>Conversions use decimals (e.g., <code>0.20</code> = <code>20%</code>).</li>
              <li>Run <strong>Calculate</strong> to reveal all results and the What‑Ifs tab.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section class="card" id="resultsTab" style="display:none">
      <div class="card-title">
        <span class="section-tag">Results</span>
        <span class="subtle">Direct carry-over of sheet formulas</span>
      </div>

      <div class="kpis">
        <div class="kpi primary">
          <div class="label">Total Sales (Revenue)</div>
          <div class="value mono" id="J11">—</div>
        </div>
        <div class="kpi primary">
          <div class="label">Sales Required / Year</div>
          <div class="value mono" id="J6">—</div>
        </div>
        <div class="kpi">
          <div class="label">Gross Profit Required</div>
          <div class="value mono" id="J13">—</div>
        </div>
        <div class="kpi">
          <div class="label">Cost of Sales</div>
          <div class="value mono" id="J12">—</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
        <div class="card" style="padding:12px">
          <div class="subtle">Expenses (per year)</div>
          <div class="mono" id="J14">—</div>
        </div>
        <div class="card" style="padding:12px">
          <div class="subtle">Desired Net Profit</div>
          <div class="mono" id="J15">—</div>
        </div>
      </div>

      <div class="divider"></div>

      <table aria-label="Sales cadence">
        <thead><tr><th>Metric</th><th class="right">Number</th><th class="right">Revenue (ex GST)</th></tr></thead>
        <tbody>
          <tr><td>Sales Required per Year</td><td class="right mono" id="J6_tbl">—</td><td class="right mono" id="K6">—</td></tr>
          <tr><td>Sales Required per Month</td><td class="right mono" id="J7">—</td><td class="right mono" id="K7">—</td></tr>
          <tr><td>Sales Required per Week</td><td class="right mono" id="J8">—</td><td class="right mono" id="K8">—</td></tr>
          <tr><td>Sales Required per Day</td><td class="right mono" id="J9">—</td><td class="right mono" id="K9">—</td></tr>
        </tbody>
      </table>

      <div class="divider"></div>

      <table aria-label="Funnel requirements">
        <thead><tr><th>Stage</th><th class="right">Per Year</th><th class="right">Per Month</th><th class="right">Per Week</th><th class="right">Per Work Day</th></tr></thead>
        <tbody>
          <tr><td>New Clients Required</td><td class="right mono" id="J44">—</td><td class="right mono" id="K44">—</td><td class="right mono" id="L44">—</td><td class="right mono" id="M44">—</td></tr>
          <tr><td>Proposals required</td><td class="right mono" id="J43">—</td><td class="right mono" id="K43">—</td><td class="right mono" id="L43">—</td><td class="right mono" id="M43">—</td></tr>
          <tr><td>Prospects required</td><td class="right mono" id="J42">—</td><td class="right mono" id="K42">—</td><td class="right mono" id="L42">—</td><td class="right mono" id="M42">—</td></tr>
          <tr><td>Leads required</td><td class="right mono" id="J41">—</td><td class="right mono" id="K41">—</td><td class="right mono" id="L41">—</td><td class="right mono" id="M41">—</td></tr>
          <tr><td>Initial Contacts required</td><td class="right mono" id="J40">—</td><td class="right mono" id="K40">—</td><td class="right mono" id="L40">—</td><td class="right mono" id="M40">—</td></tr>
        </tbody>
      </table>
    </section>

    <!-- WHAT-IFS -->
    <section class="card" id="whatifTab" style="display:none">
      <div class="card-title">
        <span class="section-tag">Section 2 — What‑If Results</span>
        <span class="subtle">Use percentages as decimals, per workbook</span>
      </div>
      <div class="grid cols">
        <div>
          <div class="inputs">
            <label for="G22">Sales value increased by x% (decimal)</label>
            <input id="G22" type="number" step="0.0001" value="0.05">

            <label for="G23">Cost of Sales decreased by x% (decimal)</label>
            <input id="G23" type="number" step="0.0001" value="0.05">

            <label for="G24">Overhead decreased by x% (decimal)</label>
            <input id="G24" type="number" step="0.0001" value="0.05">

            <label for="G25">Increase number of Sales (decimal)</label>
            <input id="G25" type="number" step="0.0001" value="0.15">
          </div>
          <p class="hint">Example: enter 0.05 for 5%.</p>
          <div class="actions">
            <button class="btn btn-primary" id="applyWhatIf">Apply What‑If</button>
            <button class="btn warn" id="clearWhatIf" type="button">Clear</button>
          </div>
        </div>
        <div>
          <div class="card" style="padding:12px">
            <div class="subtle">Explanation</div>
            <ul style="margin:6px 0 0 16px; padding:0; line-height:1.5">
              <li>New average sale = current average × (1 + increase%).</li>
              <li>Cost of sales and expenses are reduced by their % decreases.</li>
              <li>“Increase in Net Profit” compares to your desired profit in Inputs.</li>
              <li>Additional sales (%) flows revenue minus cost proportion.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="kpis">
        <div class="kpi primary"><div class="label">New Avg Sale Value</div><div class="value mono" id="G26_out">—</div></div>
        <div class="kpi"><div class="label">Total Sales (Revenue)</div><div class="value mono" id="J27">—</div></div>
        <div class="kpi"><div class="label">Cost of Sales (adjusted)</div><div class="value mono" id="J28">—</div></div>
        <div class="kpi"><div class="label">Cost of Sales %</div><div class="value mono" id="K28">—</div></div>
      </div>

      <div class="divider"></div>

      <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
        <div class="card" style="padding:12px"><div class="subtle">Gross Profit Required</div><div class="mono" id="J29">—</div></div>
        <div class="card" style="padding:12px"><div class="subtle">Expenses (adjusted)</div><div class="mono" id="J30">—</div></div>
      </div>
      <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px; margin-top:10px">
        <div class="card" style="padding:12px"><div class="subtle">Desired Net Profit (new)</div><div class="mono" id="J31">—</div></div>
        <div class="card" style="padding:12px"><div class="subtle">Increase in Net Profit</div><div class="mono" id="F29">—</div></div>
      </div>

      <div class="divider"></div>

      <div class="card" style="padding:12px">
        <div class="card-title"><span class="section-tag">Increase in NP — with Additional Sales + Price & Cost Adjs</span></div>
        <div class="mono" id="F33">—</div>
      </div>

      <div class="divider"></div>

      <table aria-label="What‑If cadence">
        <thead><tr><th>Metric</th><th class="right">Number</th></tr></thead>
        <tbody>
          <tr><td>Sales Required per Year</td><td class="right mono" id="J22">—</td></tr>
          <tr><td>Sales Required per Month</td><td class="right mono" id="J23">—</td></tr>
          <tr><td>Sales Required per Week</td><td class="right mono" id="J24">—</td></tr>
          <tr><td>Sales Required per Day</td><td class="right mono" id="J25">—</td></tr>
        </tbody>
      </table>
    </section>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const aud0 = v => new Intl.NumberFormat(undefined,{style:'currency',currency:'AUD',maximumFractionDigits:0}).format(v);
    const num0 = v => new Intl.NumberFormat(undefined,{maximumFractionDigits:0}).format(v);
    const ceil = v => Math.ceil(v);
    const clamp01 = x => Math.max(0, Math.min(1, x));
    const clamp0  = x => Math.max(0, x);
    const n = id => {const v=parseFloat($(id).value); return isNaN(v)?0:v;};

    function sanitizeInputs(){
      ['G5','G6','G10','G11','G12','G13','G15','G16'].forEach(id => { if (n(id)<0) $(id).value = 0; });
      ['G40','G41','G42','G43'].forEach(id => { $(id).value = clamp01(n(id)); });
      ['G11','G12','G16'].forEach(id => { if (n(id)<1) $(id).value = 1; });
    }

    let baseline = null;

    function calculate(){
      sanitizeInputs();
      const G5=n('G5'), G6=n('G6'), G10=n('G10'), G11=n('G11'), G12=n('G12'), G13=n('G13'), G15=n('G15'), G16=n('G16');
      const G40=clamp01(n('G40')), G41=clamp01(n('G41')), G42=clamp01(n('G42')), G43=clamp01(n('G43'));

      const G7 = G5 - G6;                         // Gross profit per sale
      const G8 = (G5!==0) ? (G7/G5) : 0;          // GP %
      const G9 = (G5!==0) ? (G6/G5) : 0;          // Cost of sale %

      const J14 = G10*12;                          // Expenses (year)
      const J15 = G13;                              // Desired net profit
      const J13 = J14 + J15;                        // Gross profit required
      const J12 = (G8!==0) ? (J13*((1-G8)/G8)) : 0; // Cost of Sales
      const J11 = J13 + J12;                        // Total Sales (Revenue)

      const J6  = (G5!==0) ? ceil(J11/G5) : 0;     // Sales / Year
      const K6  = J6*G5;
      const J7  = ceil(J6/12);
      const K7  = J7*G5;
      const J8  = ceil(J6/G11);
      const K8  = J8*G5;
      const J9  = ceil(J6/G11/5);
      const K9  = J9*G5;

      // New clients required
      const G17 = Math.max(0, ceil((G16!==0 ? (J6/G16) : 0) - G15)); // as per =ROUNDUP(J6/G16 - G15, 0)

      // Funnel (Section 3)
      const J44 = G17;               const K44 = ceil(J44/12); const L44 = ceil(J44/G11); const M44 = ceil(L44/G12);
      const J43 = (G43!==0) ? ceil(J44/G43) : 0; const K43 = ceil(J43/12); const L43 = ceil(J43/G11); const M43 = ceil(L43/G12);
      const J42 = (G42!==0) ? ceil(J43/G42) : 0; const K42 = ceil(J42/12); const L42 = ceil(J42/G11); const M42 = ceil(L42/G12);
      const J41 = (G41!==0) ? ceil(J42/G41) : 0; const K41 = ceil(J41/12); const L41 = ceil(J41/G11); const M41 = ceil(L41/G12);
      const J40 = (G40!==0) ? ceil(J41/G40) : 0; const K40 = ceil(J40/12); const L40 = ceil(J40/G11); const M40 = ceil(L40/G12);

      // Write KPI
      $('J11').textContent = aud0(clamp0(J11));
      $('J6').textContent  = num0(J6);
      $('J13').textContent = aud0(clamp0(J13));
      $('J12').textContent = aud0(clamp0(J12));
      $('J14').textContent = aud0(clamp0(J14));
      $('J15').textContent = aud0(clamp0(J15));

      $('J6_tbl').textContent = num0(J6);
      $('K6').textContent = aud0(clamp0(K6));
      $('J7').textContent = num0(J7);
      $('K7').textContent = aud0(clamp0(K7));
      $('J8').textContent = num0(J8);
      $('K8').textContent = aud0(clamp0(K8));
      $('J9').textContent = num0(J9);
      $('K9').textContent = aud0(clamp0(K9));

      // Funnel outputs
      [['J44',J44],['K44',K44],['L44',L44],['M44',M44],
       ['J43',J43],['K43',K43],['L43',L43],['M43',M43],
       ['J42',J42],['K42',K42],['L42',L42],['M42',M42],
       ['J41',J41],['K41',K41],['L41',L41],['M41',M41],
       ['J40',J40],['K40',K40],['L40',L40],['M40',M40]].forEach(([id,val])=> $(id).textContent = num0(val));

      baseline = {G5,G6,G10,G11,G12,G13,G15,G16,G40,G41,G42,G43,J6,J11,J12,J13,J14,J15};
      switchTab('resultsTab');
    }

    function applyWhatIf(){
      if (!baseline){ alert('Please run Calculate first.'); return; }
      const G22 = parseFloat($('G22').value)||0;
      const G23 = parseFloat($('G23').value)||0;
      const G24 = parseFloat($('G24').value)||0;
      const G25 = parseFloat($('G25').value)||0;

      let {G5,G6,G10,G11,G12,G13,J6,J12,J13} = baseline;

      const G26 = G5 * (1 + G22);           // New Average Sales Value
      const J27 = G26 * J6;                 // Total Sales
      const J28 = J12 * (1 - G23);          // Cost of Sales adjusted
      const K28 = (J27!==0) ? (J28 / J27) : 0;

      const J29 = J27 - J28;                // GP required (per sheet's label)
      const J30 = (G10*12) * (1 - G24);     // Expenses adjusted
      const J31 = J29 - J30;                // Desired Net Profit (new)
      const F29 = J31 - G13;                // Increase in Net Profit

      const incSalesCount = J6 * G25;       // additional sales
      const addRevenue = incSalesCount * G26;
      const addCost    = incSalesCount * (K28 * G26);
      const F33 = F29 + (addRevenue - addCost);

      // What-if cadence (rows 22..25 in J) based on J27 & G26 & baseline cadence rules
      const J22 = (G26!==0) ? Math.ceil(J27 / G26) : 0; // equals J6 baseline
      const J23 = Math.ceil(J22/12);
      const J24 = Math.ceil(J22/G11);
      const J25 = Math.ceil(J24/G12);

      // Write
      $('G26_out').textContent = aud0(G26);
      $('J27').textContent = aud0(J27);
      $('J28').textContent = aud0(J28);
      $('K28').textContent = (K28*100).toFixed(1) + '%';
      $('J29').textContent = aud0(J29);
      $('J30').textContent = aud0(J30);
      $('J31').textContent = aud0(J31);
      $('F29').textContent = aud0(F29);
      $('F33').textContent = aud0(F33);

      $('J22').textContent = num0(J22);
      $('J23').textContent = num0(J23);
      $('J24').textContent = num0(J24);
      $('J25').textContent = num0(J25);

      switchTab('whatifTab');
    }

    function clearWhatIf(){
      ['G22','G23','G24','G25'].forEach(id => $(id).value = '0');
      ['G26_out','J27','J28','K28','J29','J30','J31','F29','F33','J22','J23','J24','J25'].forEach(id => $(id).textContent = '—');
    }

    function switchTab(id){
      document.querySelectorAll('.tab').forEach(b=> b.classList.toggle('active', b.dataset.tab===id));
      ['inputsTab','resultsTab','whatifTab'].forEach(t=>{
        const el = document.getElementById(t);
        if (!el) return;
        el.style.display = (t===id)?'block':'none';
      });
    }

    document.addEventListener('click', (e)=>{
      if (e.target.classList.contains('tab')) switchTab(e.target.dataset.tab);
      if (e.target.id === 'calcBtn') calculate();
      if (e.target.id === 'resetBtn') {
        document.querySelectorAll('input').forEach(el=> el.value = el.defaultValue ?? '');
        baseline = null;
        switchTab('inputsTab');
      }
      if (e.target.id === 'applyWhatIf') applyWhatIf();
      if (e.target.id === 'clearWhatIf') clearWhatIf();
    });
  </script>
</body>
</html>
